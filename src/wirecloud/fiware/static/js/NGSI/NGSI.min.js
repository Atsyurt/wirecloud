!function(){"use strict";var a,b=new WeakMap;a="function"==typeof require&&null!=typeof exports?exports:{},a.endpoints={REGISTER_CONTEXT:"v1/registry/registerContext",DISCOVER_CONTEXT_AVAILABILITY:"v1/registry/discoverContextAvailability",SUBSCRIBE_CONTEXT_AVAILABILITY:"v1/registry/subscribeContextAvailability",UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION:"v1/registry/updateContextAvailabilitySubscription",UNSUBSCRIBE_CONTEXT_AVAILABILITY:"v1/registry/unsubscribeContextAvailability",QUERY_CONTEXT:"v1/queryContext",UPDATE_CONTEXT:"v1/updateContext",SUBSCRIBE_CONTEXT:"v1/subscribeContext",UPDATE_CONTEXT_SUBSCRIPTION:"v1/updateContextSubscription",UNSUBSCRIBE_CONTEXT:"v1/unsubscribeContext",CONTEXT_TYPES:"v1/contextTypes",v2:{BATCH_QUERY_OP:"v2/op/query",BATCH_UPDATE_OP:"v2/op/update",ENTITY_ATTRS_COLLECTION:"v2/entities/%(entityId)s/attrs",ENTITY_ATTR_ENTRY:"v2/entities/%(entityId)s/attrs/%(attribute)s",ENTITY_ATTR_VALUE_ENTRY:"v2/entities/%(entityId)s/attrs/%(attribute)s/value",ENTITY_COLLECTION:"v2/entities",ENTITY_ENTRY:"v2/entities/%(entityId)s",SUBSCRIPTION_COLLECTION:"v2/subscriptions",SUBSCRIPTION_ENTRY:"v2/subscriptions/%(subscriptionId)s",TYPE_COLLECTION:"v2/types",TYPE_ENTRY:"v2/types/%(typeId)s"}},a.proxy_endpoints={EVENTSOURCE_COLLECTION:"eventsource",CALLBACK_COLLECTION:"callbacks"};var c=function(a,b){return a.replace(/%\(\w+\)s/g,function(a){return String(b[a.slice(2,-2)])})},d=function(b,c,d,e,f){var g,h=null,i=null;null!=c&&(i="application/json",h=JSON.stringify(c)),g=JSON.parse(JSON.stringify(this.request_headers)),g.Accept="application/json",this.makeRequest(b,{method:null!=h?"POST":"GET",contentType:i,requestHeaders:g,parameters:f,postBody:h}).then(function(b){var c;if(200!==b.status)"function"==typeof e.onFailure&&(c=b instanceof a.ConnectionError?b:[0,502,504].indexOf(b.status)!==-1?new a.ConnectionError("Connection Error"):new a.InvalidResponseError("Unexpected error code: "+b.status),e.onFailure(c));else if("function"==typeof e.onSuccess){var f;try{try{f=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}f=d(f,e)}catch(a){return"function"==typeof e.onFailure&&e.onFailure(a),void("function"==typeof e.onComplete&&e.onComplete())}e.onSuccess.apply(null,f)}"function"==typeof e.onComplete&&e.onComplete()},function(b){if("function"==typeof e.onFailure){b instanceof a.ConnectionError||(b=new a.ConnectionError);try{e.onFailure(b)}catch(a){}}"function"==typeof e.onComplete&&e.onComplete()})},e=function(a,b){var c=a.trim().toLowerCase(),d=Object.keys(b),e=d.map(function(a){return a.trim().toLowerCase()}).indexOf(c);e!==-1&&delete b[d[e]]},f=function(b,c){null!=c.postBody&&(c.contentType="application/json",c.postBody=JSON.stringify(c.postBody));var d=JSON.parse(JSON.stringify(this.request_headers));d.Accept="application/json";for(var f in c.requestHeaders)null!=c.requestHeaders[f]&&(e(f,d),d[f]=c.requestHeaders[f]);return c.requestHeaders=d,this.makeRequest(b,c).then(function(b){return[0,502,504].indexOf(b.status)!==-1?Promise.reject(new a.ConnectionError):Promise.resolve(b)},function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},g=function(a){var b,c;return c="string"==typeof a.isPattern&&"true"===a.isPattern.trim().toLowerCase()||a.isPattern===!0,b={id:""+a.id,isPattern:""+c},null!=a.type&&(b.type=""+a.type),b},h=function(a){var b,c,d;if("polygon"in a.value){for(b={polygon:{vertices:[]}},c=0;c<a.value.polygon.vertices.length;c++)d=a.value.polygon.vertices[c],b.polygon.vertices.push({latitude:""+d.latitude,longitude:""+d.longitude});a.value.polygon.inverted&&(b.polygon.inverted="true")}else"circle"in a.value&&(b={circle:{centerLatitude:""+a.value.circle.centerLatitude,centerLongitude:""+a.value.circle.centerLongitude,radius:a.value.circle.radius}},a.value.circle.inverted&&(b.circle.inverted="true"));return b},i=function(a){var b,c;if(b={scopes:[]},Array.isArray(a.scopes))for(c=0;c<a.scopes.length;c++)b.scopes.push({type:a.scopes[c].type,value:h(a.scopes[c])});return b},j=function(a){var b,c;for(b=[],c=0;c<a.length;c++)b.push({name:""+a[c].name,type:""+a[c].type,value:""+a[c].value});return b},k=function(a,b,c,d,e){var f,h,i,j;for(f={contextRegistrations:[{entities:[],attributes:[],providingApplication:d}],duration:""+c},h=0;h<a.length;h+=1)f.contextRegistrations[0].entities.push(g(a[h]));for(h=0;h<b.length;h+=1)i=b[h],j={name:i.name,isDomain:"false"},null!=i.type&&(j.type=""+i.type),f.contextRegistrations[0].attributes.push(j);return null!=e&&(f.registrationId=""+e),f},l=function(a,b,c){var d,e;for(d={entities:[]},e=0;e<a.length;e+=1)d.entities.push(g(a[e]));if(Array.isArray(b)&&b.length>0)for(d.attributes=[],e=0;e<b.length;e+=1)d.attributes.push(""+b[e]);return null!=c&&(d.restriction=i(c)),d},m=function(a,b){var c,d,e,f,h,i,k,l,m;for(c={contextElements:[],updateAction:a},d=0;d<b.length;d+=1){if(f=g(b[d].entity),i=b[d].attributes,null!=i)for(h=f.attributes=[],e=0;e<i.length;e+=1)k=i[e],l={name:""+k.name},null!=k.type&&(l.type=""+k.type),"DELETE"!==a&&(m=null!=k.value?k.value:null!=k.contextValue?k.contextValue:null,l.value=m),Array.isArray(k.metadata)&&k.metadata.length>0&&(l.metadatas=j(k.metadata)),h.push(l);c.contextElements.push(f)}return c},n=function(a,b){var c,d;for(c={entities:[],attributes:b},d=0;d<a.length;d+=1)c.entities.push(g(a[d]));return c},o=function(a,b,c,d,e,f){var h,j;for(h=e?{entities:[],subscriptionId:e}:{entities:[],reference:f},j=0;j<a.length;j+=1)h.entities.push(g(a[j]));return Array.isArray(b)&&b.length>0&&(h.attributes=b),null!=c&&(h.duration=""+c),null!=d&&(h.restriction=i(d)),h},p=function(a){return{subscriptionId:a}},q=function(a,b,c,d,e,f,h){var i,j,k,l;if(a)i={subscriptionId:a};else{for(i={entities:[],reference:h},j=0;j<b.length;j+=1)i.entities.push(g(b[j]));Array.isArray(c)&&(i.attributes=c)}if(null!=d&&(i.duration=""+d),Array.isArray(f))for(i.notifyConditions=[],j=0;j<f.length;j+=1)k=f[j],l={type:k.type},i.notifyConditions.push(l),Array.isArray(k.condValues)&&(l.condValues=k.condValues);return null!=e&&(i.throttling=""+e),i},r=function(a){return{subscriptionId:a}},s=function(a,b,c){return null!=a.type&&(c.type=a.type,delete a.type),b.keyValues===!0&&(c.options="keyValues"),delete a.id,a},t=function(b){if(C(b),"object"!=typeof b||"string"!=typeof b.registrationId||"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");return[b]},u=function(a){var b,c,d,e=[];for(d=0;d<a.length;d+=1)b=a[d].contextRegistration,c={entities:[],attributes:[],providingApplication:b.providingApplication},null!=b.entities&&(c.entities=b.entities),null!=b.attributes&&(c.attributes=b.attributes),e.push(c);return e},v=function(b){if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");if(C(b),!Array.isArray(b.contextRegistrationResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[u(b.contextRegistrationResponses)]},w=function(b){if(C(b),"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");if("duration"in b&&"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");return[b]},x=function(b){if("object"!=typeof b||Array.isArray(b)||!("subscriptionId"in b))throw new a.InvalidResponseError("The server returned an invalid json structure");return[{subscriptionId:b.subscriptionId,statusCode:B(b)}]},y=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(f=!!c.flat,j=f?{}:[],n=[],b&&(i=""),g=0;g<a.length;g+=1){if(d=a[g].contextElement,m=B(a[g]),e=f?{}:{entity:null,attributes:[]},200===m.code&&f?(e.id=d.id,e.type=d.type):e.entity={id:d.id,type:d.type},null!=d.attributes)for(h=0;h<d.attributes.length;h+=1)k=d.attributes[h],b||(i=k.value),f?e[k.name]=i:(l={name:k.name,type:k.type},b||(l.value=i),null!=k.metadatas&&(l.metadata=k.metadatas),e.attributes.push(l));200===m.code?f?j[d.id]=e:j.push(e):(b&&(e.statusCode=m),n.push(e))}return[j,n]},z=function(b,c){var d,e,f;if(e=B(b),404===e.code){if("string"==typeof e.details&&(d=e.details.match(E),d&&(f=e.details={text:e.details,matches:parseInt(d[1]),offset:parseInt(d[2])})),c.details&&(f={count:0}),0!==c.offset)throw e;return[[],f]}if(200!==e.code)throw new a.InvalidResponseError("Unexpected error code");return"string"==typeof e.details&&(d=e.details.match(D),d&&(f={count:parseInt(d[1],10)})),[b.types,f]},A=function(b){var c;if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");if(c=B(b),404===c.code)throw new a.NotFoundError(b);if(200!==c.code)throw new a.InvalidResponseError("Unexpected error code");return delete b.statusCode,[b]},B=function(b){if(!("statusCode"in b))throw new a.InvalidResponseError("missing response status code info");return b.statusCode.code=parseInt(b.statusCode.code,10),b.statusCode},C=function(b){if("errorCode"in b)throw new a.InvalidRequestError(parseInt(b.errorCode.code,10),b.errorCode.reasonPhrase,b.errorCode.details)},D=new RegExp("Count: (\\d+)"),E=new RegExp("Number of matching entities: (\\d+). Offset is (\\d+)"),F=function(b,c){var d,e,f;if("object"!=typeof b||Array.isArray(b))throw new a.InvalidResponseError("The server returned an invalid json structure");try{C(b)}catch(a){switch(a.code){case 200:e=a.details.match(D),e&&(d={count:parseInt(e[1],10)});break;case 404:if(f=c.flat?{}:[],e=a.details.match(E),e?d=a.details={text:a.details,matches:parseInt(e[1]),offset:parseInt(e[2])}:c.details===!0&&0===c.offset&&(d=a.details={count:0}),0!==c.offset)throw a;return[f,d];default:throw a}}if(!Array.isArray(b.contextResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[y(b.contextResponses,!1,c)[0],d]},G=function(a,b){return C(a),y(a.contextResponses,!0,b)},H=function(b){if(C(b),"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");if("duration"in b&&"string"!=typeof b.duration)throw new a.InvalidResponseError("The server returned an invalid json structure");if("throttling"in b&&"string"!=typeof b.throttling)throw new a.InvalidResponseError("The server returned an invalid json structure");return b},I=function(b){if(C(b),"object"!=typeof b||"object"!=typeof b.subscribeResponse)throw new a.InvalidResponseError("The server returned an invalid json structure");return[H(b.subscribeResponse)]},J=function(b){if(C(b),"object"!=typeof b||"object"!=typeof b.subscribeResponse)throw new a.InvalidResponseError("The server returned an invalid json structure");return[H(b.subscribeResponse)]},K=function(b){if(C(b),"object"!=typeof b||"string"!=typeof b.subscriptionId)throw new a.InvalidResponseError("The server returned an invalid json structure");return b.statusCode=B(b),[b]},L=function(b,c){if("object"!=typeof b||Array.isArray(b)||!Array.isArray(b.contextRegistrationResponses))throw new a.InvalidResponseError("The server returned an invalid json structure");return[u(b.contextRegistrationResponses)]},M=function(a,b){var c={};if(null!=a.limit){if("number"!=typeof a.limit||a.limit<20)throw new TypeError("invalid value for the limit option");c.limit=a.limit}if(null!=a.offset){if("number"!=typeof a.offset||a.offset<0)throw new TypeError("invalid value for the offset option");c.offset=a.offset}else a.offset=0;if(null!=b)if(null!=a.details){if("boolean"!=typeof a.details)throw new TypeError("invalid value for the details option");a.details?c.details="on":c.details="off"}else c.details=b,a.details="on"===b;return c},N=function(a,b){var c={};if(null!=a.limit){if("number"!=typeof a.limit||!Number.isInteger(a.limit)||a.limit<1)throw new TypeError("invalid value for the limit option");c.limit=a.limit}else a.limit=20;if(null!=a.offset){if("number"!=typeof a.offset||!Number.isInteger(a.offset)||a.offset<0)throw new TypeError("invalid value for the offset option");c.offset=a.offset}else a.offset=0;if(null!=a.count){if("boolean"!=typeof a.count)throw new TypeError("invalid value for the count option");b.push("count")}return c};a.parseNotifyContextRequest=function(a,b){return{elements:y(a.contextResponses,!1,b)[0],subscriptionId:a.subscriptionId,originator:a.originator}};var O=function(){return this.makeRequest(this.url+a.proxy_endpoints.EVENTSOURCE_COLLECTION,{method:"POST"}).then(function(c){if([0,502,504].indexOf(c.status)!==-1)return b.get(this).promise=null,Promise.reject(new a.ConnectionError);if(201!==c.status)return b.get(this).promise=null,Promise.reject(new a.InvalidResponseError("Unexpected error code: "+c.status));var d=b.get(this);return d.source_url=c.getHeader("Location"),null==d.source_url?Promise.reject(new a.InvalidResponseError("Missing Location Header")):P.call(this)}.bind(this),function(c){return b.get(this).promise=null,c instanceof a.ConnectionError||(c=new a.ConnectionError),Promise.reject(c)}.bind(this))},P=function(){return new Promise(function(c,d){var e,f=null,g=b.get(this),h=function(a){var b=JSON.parse(a.data);clearTimeout(e),g.promise=null,g.connection_id=b.id,g.source.removeEventListener("init",f,!0),g.source.addEventListener("notification",function(a){var b=JSON.parse(a.data);g.callbacks[b.callback_id].method(b.payload,b.headers)}.bind(this),!0),c()};f=h.bind(this),g.source=new EventSource(g.source_url),g.source.addEventListener("init",f,!0),e=setTimeout(function(){g.promise=null,g.source.close(),g.source=null,d(new a.ConnectionError("Connection timeout"))}.bind(this),3e4)}.bind(this))},Q=function(){var a={},c=b.get(this).callbacks;for(var d in c)a[d]=c[d].subscription;return a},R=function(){var a=b.get(this);return null!=a.source&&null!=a.connection_id},S=function(){return null!==b.get(this).promise},T=function(){return b.get(this).connection_id},U=function(){var a={},c=b.get(this).callbacksBySubscriptionId;for(var d in c)a[d]=c[d].callback_id;return a};a.ProxyConnection=function(a,c){this.url=""+a,"/"!==this.url[this.url.length-1]&&(this.url+="/"),this.makeRequest=c,b.set(this,{callbacks:{},callbacksBySubscriptionId:{},connected:!1,connection_id:null,promise:null,source:null}),Object.defineProperties(this,{callbackSubscriptions:{get:Q},connected:{get:R},connecting:{get:S},connection_id:{get:T},subscriptionCallbacks:{get:U}})},a.ProxyConnection.prototype.connect=function(){if(this.connected===!0)return Promise.resolve();var a=b.get(this);return null===a.promise&&(a.promise=O.call(this)),a.promise},a.ProxyConnection.prototype.requestCallback=function(c){if("function"!=typeof c)throw new TypeError("callback parameter must be a function");return this.connect().then(function(){return this.makeRequest(this.url+a.proxy_endpoints.CALLBACK_COLLECTION,{method:"POST",contentType:"application/json",postBody:JSON.stringify({connection_id:this.connection_id})}).then(function(d){if([200,201].indexOf(d.status)===-1)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+d.status));var e=JSON.parse(d.responseText),f=b.get(this);return f.callbacks[e.callback_id]={callback_id:e.callback_id,method:c,subscription:null},Promise.resolve(e)}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})}.bind(this))},a.ProxyConnection.prototype.close=function(){if(this.connected===!1)return Promise.resolve();var c=b.get(this);return this.makeRequest(c.source_url,{method:"DELETE"}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):(c.source.close(),c.source=null,c.connection_id=null,c.callbacks={},void(c.callbacksBySubscriptionId={}))}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},a.ProxyConnection.prototype.closeCallback=function(b){return this.makeRequest(this.url+a.proxy_endpoints.CALLBACK_COLLECTION+"/"+b,{method:"DELETE"}).then(function(c){return 204!==c.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+c.status)):void this.purgeCallback(b)}.bind(this),function(b){return b instanceof a.ConnectionError||(b=new a.ConnectionError),Promise.reject(b)})},a.ProxyConnection.prototype.associateSubscriptionId=function(a,c){var d=b.get(this);if(!(a in d.callbacks))return this;if(null!=d.callbacks[a].subscription)throw new TypeError("Already associated callback");return d.callbacksBySubscriptionId[c]=d.callbacks[a],d.callbacks[a].subscription=c,this},a.ProxyConnection.prototype.closeSubscriptionCallback=function(a){var c=b.get(this);return a in c.callbacksBySubscriptionId?this.closeCallback(c.callbacksBySubscriptionId[a].callback_id):Promise.resolve()},a.ProxyConnection.prototype.purgeCallback=function(a){var c=b.get(this);if(a in c.callbacks){var d=c.callbacks[a].subscription;null!=d&&delete c.callbacksBySubscriptionId[d],delete c.callbacks[a]}},a.ConnectionError=function(a){this.name="ConnectionError",this.message=a||"Connection Error"},a.ConnectionError.prototype=new Error,a.ConnectionError.prototype.constructor=a.ConnectionError,a.InvalidRequestError=function(a,b,c){this.name="InvalidRequest",this.code=a,this.message=b||"",this.details=c||""},a.InvalidRequestError.prototype=new Error,a.InvalidRequestError.prototype.constructor=a.InvalidRequestError,a.InvalidResponseError=function(a){this.name="InvalidResponse",this.message=a||""},a.InvalidResponseError.prototype=new Error,a.InvalidResponseError.prototype.constructor=a.InvalidResponseError,a.NotFoundError=function(a){this.name="NotFound",this.details=a||""},a.NotFoundError.prototype=new Error,a.NotFoundError.prototype.constructor=a.NotFoundError,a.ProxyConnectionError=function(a){this.name="ProxyConnectionError",this.cause=a},a.ProxyConnectionError.prototype=new Error,a.ProxyConnectionError.prototype.constructor=a.ProxyConnectionError,a.Connection=function(b,c){this.url=""+b,"/"!==this.url[this.url.length-1]&&(this.url+="/"),null==c&&(c={}),null!=c.request_headers?this.request_headers=c.request_headers:this.request_headers={},null!=c.service&&(e("FIWARE-Service",this.request_headers),this.request_headers["FIWARE-Service"]=c.service),null!=c.servicepath&&(e("FIWARE-ServicePath",this.request_headers),this.request_headers["FIWARE-ServicePath"]=c.servicepath),"function"==typeof c.requestFunction&&(this.makeRequest=c.requestFunction),c.ngsi_proxy_connection instanceof a.ProxyConnection?this.ngsi_proxy=c.ngsi_proxy_connection:"string"==typeof c.ngsi_proxy_url&&(this.ngsi_proxy=new a.ProxyConnection(c.ngsi_proxy_url,this.makeRequest)),Object.defineProperty(this,"v1",{value:this}),Object.defineProperty(this,"v2",{value:new a.Connection.V2(this)})},a.Connection.prototype.createRegistration=function(b,c,e,f,g){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=c&&!Array.isArray(c))throw new TypeError("attributes parameter must be an array or null");null==c&&(c=[]),null==g&&(g={});var h=k(b,c,e,f),i=this.url+a.endpoints.REGISTER_CONTEXT;d.call(this,i,h,t,g)},a.Connection.prototype.updateRegistration=function(b,c,e,f,g,h){if(!Array.isArray(c)||0===c.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=e&&!Array.isArray(e))throw new TypeError("attributes parameter must be an array or null");null==e&&(e=[]),null==h&&(h={});var i=k(c,e,f,g,b),j=this.url+a.endpoints.REGISTER_CONTEXT;d.call(this,j,i,t,h)},a.Connection.prototype.cancelRegistration=function(a,b){if(null==a)throw new TypeError("regId parameter cannot be null");this.updateRegistration(a,[{id:"canceled registration"}],[],"PT0H","http://canceled.registration.com",b)},a.Connection.prototype.discoverAvailability=function(b,c,e){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=c&&!Array.isArray(c))throw new TypeError("attributeNames parameter must be an array or null");null==c&&(c=[]),null==e&&(e={});var f=n(b,c),g=this.url+a.endpoints.DISCOVER_CONTEXT_AVAILABILITY;d.call(this,g,f,v,e)},a.Connection.prototype.createAvailabilitySubscription=function(b,c,e,f,g){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=c&&!Array.isArray(c))throw new TypeError("attributeNames parameter must be an array or null");if(null==g)throw new TypeError("Missing options parameter");if("string"!=typeof g.onNotify&&"function"!=typeof g.onNotify)throw new TypeError("Invalid onNotify callback");if("function"==typeof g.onNotify&&null==this.ngsi_proxy)throw new TypeError("A ngsi-proxy is needed for using local onNotify callbacks");var h=this.url+a.endpoints.SUBSCRIBE_CONTEXT_AVAILABILITY;if("function"==typeof g.onNotify&&null!=this.ngsi_proxy){var i=function(a){var b=JSON.parse(a),c=L(b,g);g.onNotify(c)};this.ngsi_proxy.requestCallback(i).then(function(a){var i=o(b,c,e,f,null,a.url),j=g.onFailure;g.onFailure=function(){this.ngsi_proxy.closeCallback(a.callback_id),"function"==typeof j&&j.apply(this,arguments)}.bind(this);var k=g.onSuccess;g.onSuccess=function(b){this.ngsi_proxy.associateSubscriptionId(a.callback_id,b.subscriptionId),"function"==typeof k&&k(b)}.bind(this),d.call(this,h,i,w,g)}.bind(this),function(){"function"==typeof g.onFailure&&g.onFailure()})}else{var j=o(b,c,e,f,null,g.onNotify);d.call(this,h,j,w,g)}},a.Connection.prototype.updateAvailabilitySubscription=function(b,c,e,f,g,h){if(null==b)throw new TypeError("subId parameter cannot be null");if(!Array.isArray(c)||0===c.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=e&&!Array.isArray(e))throw new TypeError("attributeNames parameter must be an array or null");null==h&&(h={});var i=o(c,e,f,g,b),j=this.url+a.endpoints.UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION;d.call(this,j,i,w,h)},a.Connection.prototype.cancelAvailabilitySubscription=function(b,c){if(null==b)throw new TypeError("subId parameter cannot be null");null==c&&(c={});var e=p(b),f=this.url+a.endpoints.UNSUBSCRIBE_CONTEXT_AVAILABILITY;d.call(this,f,e,x,c)},a.Connection.prototype.query=function(b,c,e){var f,g,h;if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=c&&!Array.isArray(c))throw new TypeError("attrNames must be null or an array");null==c&&(c=[]),null==e&&(e={}),g=M(e,"off"),f=this.url+a.endpoints.QUERY_CONTEXT,h=l(b,c,e.restriction),d.call(this,f,h,F,e,g)},a.Connection.prototype.updateAttributes=function(b,c){if(!Array.isArray(b)||0===b.length)throw new TypeError("update parameter must be a non-empty array");null==c&&(c={});var e=m("UPDATE",b),f=this.url+a.endpoints.UPDATE_CONTEXT;d.call(this,f,e,G,c)},a.Connection.prototype.addAttributes=function(b,c){if(!Array.isArray(b)||0===b.length)throw new TypeError("toAdd parameter must be a non-empty array");null==c&&(c={});var e=m("APPEND",b),f=this.url+a.endpoints.UPDATE_CONTEXT;d.call(this,f,e,G,c)},a.Connection.prototype.deleteAttributes=function(b,c){if(!Array.isArray(b)||0===b.length)throw new TypeError("toDelete parameter must be a non-empty array");null==c&&(c={});var e=m("DELETE",b),f=this.url+a.endpoints.UPDATE_CONTEXT;d.call(this,f,e,G,c)},a.Connection.prototype.createSubscription=function(b,c,e,f,g,h){if(!Array.isArray(b)||0===b.length)throw new TypeError("entities parameter must be a non-empty array");if(null!=c&&!Array.isArray(c))throw new TypeError("attributeNames parameter must be an array or null");if(null==h)throw new TypeError("Missing options parameter");if("string"!=typeof h.onNotify&&"function"!=typeof h.onNotify)throw new TypeError("Invalid onNotify callback");if("function"==typeof h.onNotify&&null==this.ngsi_proxy)throw new TypeError("A ngsi-proxy is needed for using local onNotify callbacks");var i=this.url+a.endpoints.SUBSCRIBE_CONTEXT;if("function"==typeof h.onNotify&&null!=this.ngsi_proxy){var j=function(b){var c=JSON.parse(b),d=a.parseNotifyContextRequest(c,h);h.onNotify(d)};this.ngsi_proxy.requestCallback(j).then(function(a){var j=q(null,b,c,e,f,g,a.url),k=h.onFailure;h.onFailure=function(){this.ngsi_proxy.closeCallback(a.callback_id),"function"==typeof k&&k.apply(this,arguments)}.bind(this);var l=h.onSuccess;h.onSuccess=function(b){this.ngsi_proxy.associateSubscriptionId(a.callback_id,b.subscriptionId),"function"==typeof l&&l(b)}.bind(this),d.call(this,i,j,I,h)}.bind(this),function(b){if("function"==typeof h.onFailure){var c=new a.ProxyConnectionError(b);try{h.onFailure(c)}catch(a){}}if("function"==typeof h.onComplete)try{h.onComplete()}catch(a){}})}else{var k=q(null,b,c,e,f,g,h.onNotify);d.call(this,i,k,I,h)}},a.Connection.prototype.updateSubscription=function(b,c,e,f,g){if(null==b)throw new TypeError("subId parameter cannot be null");null==g&&(g={});var h=q(b,null,null,c,e,f),i=this.url+a.endpoints.UPDATE_CONTEXT_SUBSCRIPTION;d.call(this,i,h,J,g)},a.Connection.prototype.cancelSubscription=function(b,c){if(null==b)throw new TypeError("subId parameter cannot be null");if(null==c&&(c={}),this.ngsi_proxy){var e=c.onSuccess;c.onSuccess=function(a){this.ngsi_proxy.closeSubscriptionCallback(a.subscriptionId),"function"==typeof e&&e(a)}.bind(this)}var f=r(b),g=this.url+a.endpoints.UNSUBSCRIBE_CONTEXT;d.call(this,g,f,K,c)},a.Connection.prototype.getAvailableTypes=function(b){var c=this.url+a.endpoints.CONTEXT_TYPES,e=M(b,"on");d.call(this,c,null,z,b,e)},a.Connection.prototype.getTypeInfo=function(b,c){if(null==b)throw new TypeError("Invalid type parameter");var e=this.url+a.endpoints.CONTEXT_TYPES+"/"+encodeURIComponent(b);d.call(this,e,null,A,c)},a.Connection.V2=function(a){b.set(this,a)},a.Connection.V2.prototype.listEntities=function(c){if(null==c&&(c={}),null!=c.id&&null!=c.idPattern)throw new TypeError("id and idPattern options cannot be used at the same time");if(null!=c.type&&null!=c.typePattern)throw new TypeError("type and typePattern options cannot be used at the same time");var d=b.get(this),e=d.url+a.endpoints.v2.ENTITY_COLLECTION,g=[],h=N(c,g);return c.keyValues===!0&&g.push("keyValues"),c.values===!0&&g.push("values"),c.unique===!0&&g.push("unique"),0!==g.length&&(h.options=g.join(",")),h.attrs=c.attrs,h.id=c.id,h.idPattern=c.idPattern,h.orderBy=c.orderBy,h.metadata=c.metadata,h.mq=c.mq,h.q=c.q,h.type=c.type,h.typePattern=c.typePattern,h.georel=c.georel,h.geometry=c.geometry,h.coords=c.coords,f.call(d,e,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var d=JSON.parse(b.responseText)}catch(b){return Promise.reject(new a.InvalidResponseError("Server returned invalid JSON content"))}var e={results:d,limit:c.limit,offset:c.offset,correlator:b.getHeader("Fiware-correlator")};return c.count===!0&&(e.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(e)})},a.Connection.V2.prototype.createEntity=function(c,d){null==d&&(d={});var e=b.get(this),g={};d.keyValues===!0&&(g.options="keyValues");var h=e.url+a.endpoints.v2.ENTITY_COLLECTION;return f.call(e,h,{method:"POST",postBody:c,parameters:g,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 201!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator"),entity:c,location:b.getHeader("Location")})})},a.Connection.V2.prototype.getEntity=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ENTRY,{entityId:encodeURIComponent(d.id)}),h={};return null!=d.type&&(h.type=d.type),d.keyValues===!0&&(h.options="keyValues"),f.call(e,g,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({correlator:b.getHeader("Fiware-correlator"),entity:c})})},a.Connection.V2.prototype.getEntityAttributes=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(d.id)}),h={};return null!=d.type&&(h.type=d.type),d.keyValues===!0&&(h.options="keyValues"),f.call(e,g,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({attributes:c,correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.appendEntityAttributes=function(d,e){null==e&&(e={});var g=b.get(this),h=g.url+c(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(d.id)}),i={},j=[];return delete d.id,null!=d.type&&(i.type=d.type,delete d.type),e.strict===!0&&j.push("append"),e.keyValues===!0&&j.push("keyValues"),j.length>0&&(i.options=j.join(",")),f.call(g,h,{method:"POST",parameters:i,postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.updateEntityAttributes=function(d,e){if(null==e&&(e={}),null==d)throw new TypeError("missing changes parameter");var g=b.get(this),h=g.url+c(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(d.id)}),i={};return delete d.id,null!=d.type&&(i.type=d.type,delete d.type),e.keyValues===!0&&(i.options="keyValues"),f.call(g,h,{method:"PATCH",parameters:i,postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.replaceEntityAttributes=function(d,e){null==e&&(e={});var g=b.get(this),h=g.url+c(a.endpoints.v2.ENTITY_ATTRS_COLLECTION,{entityId:encodeURIComponent(d.id)}),i={},j=s(d,e,i);return f.call(g,h,{method:"PUT",postBody:j,parameters:i,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({entity:d,correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.deleteEntity=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ENTRY,{entityId:encodeURIComponent(d.id)}),h={};return null!=d.type&&(h.type=d.type),f.call(e,g,{method:"DELETE",parameters:h,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.getEntityAttribute=function(d){if(null==d)throw new TypeError("missing options parameter");if(null==d.id)throw new TypeError("missing id option");if(null==d.attribute)throw new TypeError("missing attribute option");var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(d.id),attribute:encodeURIComponent(d.attribute)
}),h={};return null!=d.type&&(h.type=d.type),f.call(e,g,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({correlator:b.getHeader("Fiware-correlator"),attribute:c})})},a.Connection.V2.prototype.replaceEntityAttribute=function(d){if(null==d)throw new TypeError("missing options parameter");if(null==d.id)throw new TypeError("missing id option");if(null==d.attribute)throw new TypeError("missing attribute option");var e={value:d.value,metadata:d.metadata},g=b.get(this),h=g.url+c(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(d.id),attribute:encodeURIComponent(d.attribute)}),i={};return null!=d.type&&(i.type=d.type),f.call(g,h,{method:"PUT",parameters:i,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator"),attribute:e})})},a.Connection.V2.prototype.deleteEntityAttribute=function(d){if(null==d)throw new TypeError("missing options parameter");if(null==d.id)throw new TypeError("missing id option");if(null==d.attribute)throw new TypeError("missing attribute option");var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ATTR_ENTRY,{entityId:encodeURIComponent(d.id),attribute:encodeURIComponent(d.attribute)}),h={};return null!=d.type&&(h.type=d.type),f.call(e,g,{method:"DELETE",parameters:h,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.getEntityAttributeValue=function(d){if(null==d)throw new TypeError("missing options parameter");if(null==d.id)throw new TypeError("missing id option");if(null==d.attribute)throw new TypeError("missing attribute option");var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ATTR_VALUE_ENTRY,{entityId:encodeURIComponent(d.id),attribute:encodeURIComponent(d.attribute)}),h={};return null!=d.type&&(h.type=d.type),f.call(e,g,{method:"GET",parameters:h,requestHeaders:{Accept:"application/json, text/plain","FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({correlator:b.getHeader("Fiware-correlator"),value:c})})},a.Connection.V2.prototype.replaceEntityAttributeValue=function(d){if(null==d)throw new TypeError("missing options parameter");if(null==d.id)throw new TypeError("missing id option");if(null==d.attribute)throw new TypeError("missing attribute option");if("undefined"==typeof d.value)throw new TypeError("missing value option");var e=b.get(this),g=e.url+c(a.endpoints.v2.ENTITY_ATTR_VALUE_ENTRY,{entityId:encodeURIComponent(d.id),attribute:encodeURIComponent(d.attribute)}),h={};return null!=d.type&&(h.type=d.type),f.call(e,g,{method:"PUT",parameters:h,postBody:d.value,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator"),value:d.value})})},a.Connection.V2.prototype.listTypes=function(c){null==c&&(c={});var d=b.get(this),e=d.url+a.endpoints.v2.TYPE_COLLECTION,g=[],h=N(c,g);return c.values===!0&&g.push("values"),0!==g.length&&(h.options=g.join(",")),f.call(d,e,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));var d={correlator:b.getHeader("Fiware-correlator"),limit:c.limit,offset:c.offset,results:JSON.parse(b.responseText)};return c.count===!0&&(d.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(d)})},a.Connection.V2.prototype.getType=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.TYPE_ENTRY,{typeId:encodeURIComponent(d.id)});return f.call(e,g,{method:"GET",requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({correlator:b.getHeader("Fiware-correlator"),type:c})})},a.Connection.V2.prototype.listSubscriptions=function(c){null==c&&(c={});var d=b.get(this),e=d.url+a.endpoints.v2.SUBSCRIPTION_COLLECTION,g=[],h=N(c,g);return 0!==g.length&&(h.options=g.join(",")),f.call(d,e,{method:"GET",parameters:h,requestHeaders:{"FIWARE-Correlator":c.correlator,"FIWARE-Service":c.service,"FIWARE-ServicePath":c.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));var d={correlator:b.getHeader("Fiware-correlator"),limit:c.limit,offset:c.offset,results:JSON.parse(b.responseText)};return c.count===!0&&(d.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(d)})},a.Connection.V2.prototype.createSubscription=function(c,d){var e,g,h=b.get(this);if(null==d&&(d={}),"object"!=typeof c)throw new TypeError("invalid subscription parameter");if("callback"in c.notification){if("function"!=typeof c.notification.callback)throw new TypeError("invalid callback configuration");var i=function(a,b){var c=JSON.parse(a);c.attrsformat=b["ngsiv2-attrsformat"],this(c)}.bind(c.notification.callback);e=h.ngsi_proxy.requestCallback(i).then(function(a){g=a,delete c.notification.callback,c.notification.http={url:g.url}})}else e=Promise.resolve();var j=h.url+a.endpoints.v2.SUBSCRIPTION_COLLECTION;return e.then(function(){return f.call(h,j,{method:"POST",postBody:c,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}})}).then(function(b){if(201!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));var d=b.getHeader("Location"),e=d.split("/").pop();return c.id=e,g&&this.ngsi_proxy.associateSubscriptionId(g.callback_id,e),Promise.resolve({correlator:b.getHeader("Fiware-correlator"),subscription:c,location:d})}.bind(h),function(a){return g&&this.ngsi_proxy.closeCallback(g.callback_id),Promise.reject(a)}.bind(h))},a.Connection.V2.prototype.getSubscription=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(d.id)});return f.call(e,g,{method:"GET",requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){throw new a.InvalidResponseError("Server returned invalid JSON content")}return Promise.resolve({correlator:b.getHeader("Fiware-correlator"),subscription:c})})},a.Connection.V2.prototype.updateSubscription=function(d,e){null==e&&(e={});var g=b.get(this),h=g.url+c(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(d.id)});return delete d.id,f.call(g,h,{method:"PATCH",postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.deleteSubscription=function(d){if(null==d)throw new TypeError("missing options parameter");"string"==typeof d&&(d={id:d});var e=b.get(this),g=e.url+c(a.endpoints.v2.SUBSCRIPTION_ENTRY,{subscriptionId:encodeURIComponent(d.id)});return f.call(e,g,{method:"DELETE",requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.batchUpdate=function(d,e){if(null==e&&(e={}),null==d)throw new TypeError("missing changes parameter");var g=b.get(this),h=g.url+c(a.endpoints.v2.BATCH_UPDATE_OP),i={};return e.keyValues===!0&&(i.options="keyValues"),f.call(g,h,{method:"POST",parameters:i,postBody:d,requestHeaders:{"FIWARE-Correlator":e.correlator,"FIWARE-Service":e.service,"FIWARE-ServicePath":e.servicepath}}).then(function(b){return 204!==b.status?Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status)):Promise.resolve({correlator:b.getHeader("Fiware-correlator")})})},a.Connection.V2.prototype.batchQuery=function(c,d){if(null==d&&(d={}),null==c)throw new TypeError("missing query parameter");var e=b.get(this),g=e.url+a.endpoints.v2.BATCH_QUERY_OP,h=[],i=N(d,h);return d.keyValues===!0&&h.push("keyValues"),d.values===!0&&h.push("values"),d.unique===!0&&h.push("unique"),h.length>0&&(i.options=h.join(",")),i.orderBy=d.orderBy,f.call(e,g,{method:"POST",parameters:i,postBody:c,requestHeaders:{"FIWARE-Correlator":d.correlator,"FIWARE-Service":d.service,"FIWARE-ServicePath":d.servicepath}}).then(function(b){if(200!==b.status)return Promise.reject(new a.InvalidResponseError("Unexpected error code: "+b.status));try{var c=JSON.parse(b.responseText)}catch(b){return Promise.reject(new a.InvalidResponseError("Server returned invalid JSON content"))}var e={results:c,limit:d.limit,offset:d.offset,correlator:b.getHeader("Fiware-correlator")};return d.count===!0&&(e.count=parseInt(b.getHeader("Fiware-Total-Count"),10)),Promise.resolve(e)})},"undefined"!=typeof window&&(window.NGSI=a)}();
//# sourceMappingURL=NGSI.min.js.map